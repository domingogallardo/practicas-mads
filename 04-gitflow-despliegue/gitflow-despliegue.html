
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.5">
    
    
      
        <title>Pr치ctica 4 - Pr치cticas MADS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Ubuntu";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-3-trabajo-en-equipo-con-gitflow-y-diseno-de-nuevas-funcionalidades" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href=".." title="Pr치cticas MADS" class="md-header__button md-logo" aria-label="Pr치cticas MADS" data-md-component="logo">
      
  <img src="../imagenes/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pr치cticas MADS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pr치ctica 4
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B칰squeda" placeholder="B칰squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Limpiar" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b칰squeda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegaci칩n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Pr치cticas MADS" class="md-nav__button md-logo" aria-label="Pr치cticas MADS" data-md-component="logo">
      
  <img src="../imagenes/logo.png" alt="logo">

    </a>
    Pr치cticas MADS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      <label class="md-nav__link" for="__nav_1">
        Pr치ctica 1
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Pr치ctica 1" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Pr치ctica 1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01-intro-spring-boot/practica1.html" class="md-nav__link">
        Primera aplicaci칩n con Spring Boot
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01-intro-spring-boot/intro-spring-boot.html" class="md-nav__link">
        Introducci칩n a Spring Boot
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01-intro-spring-boot/comandos-git.html" class="md-nav__link">
        Comandos Git
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../02-todolist/practica2.html" class="md-nav__link">
        Pr치ctica 2
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../03-pruebas-tdd/integration-tdd.html" class="md-nav__link">
        Pr치ctica 3
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Pr치ctica 4
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="gitflow-despliegue.html" class="md-nav__link md-nav__link--active">
        Pr치ctica 4
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objetivos-y-resumen-de-la-practica" class="md-nav__link">
    Objetivos y resumen de la pr치ctica
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formacion-de-equipos" class="md-nav__link">
    Formaci칩n de equipos
  </a>
  
    <nav class="md-nav" aria-label="Formaci칩n de equipos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pasos-a-seguir" class="md-nav__link">
    Pasos a seguir
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nuevo-flujo-de-trabajo-para-los-issues" class="md-nav__link">
    Nuevo flujo de trabajo para los issues
  </a>
  
    <nav class="md-nav" aria-label="Nuevo flujo de trabajo para los issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comandos-git" class="md-nav__link">
    Comandos Git
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pasos-a-seguir_1" class="md-nav__link">
    Pasos a seguir
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-gitflow" class="md-nav__link">
    Configuraci칩n de GitFlow
  </a>
  
    <nav class="md-nav" aria-label="Configuraci칩n de GitFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ramas-de-largo-recorrido" class="md-nav__link">
    Ramas de largo recorrido
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ramas-de-feature" class="md-nav__link">
    Ramas de feature
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ramas-de-release" class="md-nav__link">
    Ramas de release
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ramas-de-hot-fix" class="md-nav__link">
    Ramas de hot-fix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nuevas-funcionalidades-para-la-aplicacion" class="md-nav__link">
    Nuevas funcionalidades para la aplicaci칩n
  </a>
  
    <nav class="md-nav" aria-label="Nuevas funcionalidades para la aplicaci칩n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pasos-a-seguir_5" class="md-nav__link">
    Pasos a seguir
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entrega-y-evaluacion" class="md-nav__link">
    Entrega y evaluaci칩n
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../05-iteracion-scrum/iteracion-scrum.html" class="md-nav__link">
        Pr치ctica 5
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../06-practica-c4/practica-c4.html" class="md-nav__link">
        Pr치ctica C4
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objetivos-y-resumen-de-la-practica" class="md-nav__link">
    Objetivos y resumen de la pr치ctica
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formacion-de-equipos" class="md-nav__link">
    Formaci칩n de equipos
  </a>
  
    <nav class="md-nav" aria-label="Formaci칩n de equipos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pasos-a-seguir" class="md-nav__link">
    Pasos a seguir
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nuevo-flujo-de-trabajo-para-los-issues" class="md-nav__link">
    Nuevo flujo de trabajo para los issues
  </a>
  
    <nav class="md-nav" aria-label="Nuevo flujo de trabajo para los issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comandos-git" class="md-nav__link">
    Comandos Git
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pasos-a-seguir_1" class="md-nav__link">
    Pasos a seguir
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-gitflow" class="md-nav__link">
    Configuraci칩n de GitFlow
  </a>
  
    <nav class="md-nav" aria-label="Configuraci칩n de GitFlow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ramas-de-largo-recorrido" class="md-nav__link">
    Ramas de largo recorrido
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ramas-de-feature" class="md-nav__link">
    Ramas de feature
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ramas-de-release" class="md-nav__link">
    Ramas de release
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ramas-de-hot-fix" class="md-nav__link">
    Ramas de hot-fix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nuevas-funcionalidades-para-la-aplicacion" class="md-nav__link">
    Nuevas funcionalidades para la aplicaci칩n
  </a>
  
    <nav class="md-nav" aria-label="Nuevas funcionalidades para la aplicaci칩n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pasos-a-seguir_5" class="md-nav__link">
    Pasos a seguir
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entrega-y-evaluacion" class="md-nav__link">
    Entrega y evaluaci칩n
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="practica-3-trabajo-en-equipo-con-gitflow-y-diseno-de-nuevas-funcionalidades">Pr치ctica 3: Trabajo en equipo con GitFlow y dise침o de nuevas funcionalidades<a class="headerlink" href="#practica-3-trabajo-en-equipo-con-gitflow-y-diseno-de-nuevas-funcionalidades" title="Permanent link">&para;</a></h1>
<h2 id="objetivos-y-resumen-de-la-practica">Objetivos y resumen de la pr치ctica<a class="headerlink" href="#objetivos-y-resumen-de-la-practica" title="Permanent link">&para;</a></h2>
<p>En esta pr치ctica se pretende conseguir:</p>
<ol>
<li>Crear los equipos de trabajo en GitHub.</li>
<li>Adaptar el flujo de trabajo en Git y GitHub al trabajo en equipo.<ul>
<li>Implementar GitFlow.</li>
<li>Desarrollar nuevas features con GitFlow.</li>
<li>Lanzamiento de una versi칩n nueva usando GitFlow.</li>
</ul>
</li>
<li>Preparar el <em>backlog</em> del producto con las nuevas historias de
   usuario a implementar en la siguiente iteraci칩n de la aplicaci칩n
   que se realizar치 en la pr치ctica 4.</li>
</ol>
<h2 id="formacion-de-equipos">Formaci칩n de equipos<a class="headerlink" href="#formacion-de-equipos" title="Permanent link">&para;</a></h2>
<p>En esta pr치ctica comenzamos a trabajar en equipos de 3 personas (de
forma excepcional podr칤an ser 2 o 4 personas).</p>
<p>Cada equipo trabajar치 con un repositorio com칰n seleccionado de uno de
los miembros del equipo. Utilizaremos <em>GitHub Classroom</em> para crear el
<em>team</em> y el repositorio.</p>
<h3 id="pasos-a-seguir">Pasos a seguir<a class="headerlink" href="#pasos-a-seguir" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Deb칠is formar equipos de <strong>3 personas</strong>. Enviad los componentes al
  foro de Moodle y os asignar칠 un nombre de equipo. Utilizad despu칠s
  el enlace de GitHub Classroom que enviar칠 al foro de Moodle para
  crear el equipo y apuntaros a 칠l.</p>
<p>El primero que use el enlace debe crear el repositorio,
escribiendo el nombre del equipo, como se muestra en la siguiente
imagen.</p>
<p><img src="imagenes/nombre-repo-github-classroom.png" width="600px"/></p>
<p>El equipo trabajar치 con un repositorio creado por GitHub Classroom
con el nombre <code>todolist-final-NOMBRE-EQUIPO</code>. Al igual que en
la pr치ctica 1, el repositorio se crear치 en el grupo <code>mads-ua-20-21</code>.</p>
<p><img src="imagenes/repo-creado-github-classroom.png" width="700px"/></p>
<p>Una vez que la primera persona ha creado el equipo y el
repositorio, las siguientes personas que usan el enlace pueden
unirse al equipo creado o crear un nuevo equipo:</p>
<p><img src="imagenes/unirse-repo-github-classroom.png" width="700px"/></p>
</li>
<li>
<p>Una vez creado el repositorio deb칠is crear en 칠l un tablero para
  gestionar las tarjetas con los <em>issues</em> y los pull
  requests. Creadlos con las mismas columnas que en las pr치cticas 1 y 2.</p>
</li>
<li>
<p>Escoged el proyecto que vais a usar como punto de partida de estas
  dos 칰ltimas pr치cticas de entre los proyectos de los miembros del
  equipo. Intentad que se un proyecto con c칩digo limpio y f치cilmente
  ampliable.</p>
<p>Subidlo al nuevo repositorio, cambiando la URL del <code>origin</code> del
repositorio local y haciendo un push:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git remote set-url origin https://github.com/mads-ua-20-21/todolist-final-NOMBRE-EQUIPO.git
$ git push -u origin main
</code></pre></div>
</td></tr></table>
<p>Por 칰ltimo, los otros miembros del equipo deber치n clonar el
repositorio para que los tres pod치is trabajar con 칠l en local.</p>
</li>
<li>
<p>Cambiad el nombre del proyecto (en el fichero <code>POM.xml</code> y en el
  <code>about.html</code> a <code>todolist-final-equipo-XX</code>.</p>
<p>Haced un commit directamente en <code>main</code> con estos
cambios. Comprobad que GitHub Actions sigue funcionando
correctamente. </p>
</li>
</ul>
<h2 id="nuevo-flujo-de-trabajo-para-los-issues">Nuevo flujo de trabajo para los <em>issues</em><a class="headerlink" href="#nuevo-flujo-de-trabajo-para-los-issues" title="Permanent link">&para;</a></h2>
<p>Debemos adaptar el flujo de trabajo en GitHub al trabajo en equipo. En
cuanto a la gesti칩n de los <em>issues</em> y tablero del proyecto cambiaremos
lo siguiente:</p>
<ul>
<li><strong>Selecci칩n del <em>issue</em></strong>: Al pasar un <em>issue</em> de <code>To do</code>a <code>In
  progress</code> se debe asignar un responsable del desarrollo del <em>issue</em>.</li>
<li><strong>Nueva rama con el <em>issue</em></strong>: El responsable seleccionado ser치 el que abra una
  rama nueva para el desarrollo del ticket y la subir치 a
  GitHub.</li>
<li><strong>Desarrollo</strong>: Se trabaja en la rama. Cualquier compa침ero puede
  unirse al ticket y trabajar junto con el responsable, trabajando
  sobre la rama.</li>
<li><strong>Pull request</strong>: Cuando el ticket se ha terminado, el responsable
  abre un pull request en GitHub y pone la tarjeta en la columna
  <code>In pull request</code>.</li>
<li><strong>Revisi칩n de c칩digo</strong>: Los miembros del equipo revisan el c칩digo en
  el pull request (consultar documentaci칩n en GitHub: <a href="https://help.github.com/articles/reviewing-proposed-changes-in-a-pull-request/">Reviewing
  proposed changes in a pull
  request</a>). Al
  menos uno de los miembros del equipo deben dar el OK, a침adiendo una
  reacci칩n. Deb칠is configurar la opci칩n de GitHub que obliga a que
  haya un <a href="https://docs.github.com/en/free-pro-team@latest/github/administering-a-repository/enabling-required-reviews-for-pull-requests">m칤nimo de revisores</a> en el pull request.</li>
<li><strong>Integraci칩n del pull request</strong>: Cuando un miembro da el OK, el
  responsable de la tarea integra el pull request.</li>
</ul>
<p>Para implementar el trabajo en equipo ser치 necesario trabajar sobre
ramas remotas compartidas. A continuaci칩n explicamos con m치s detalle
algunos aspectos comandos de Git necesarios.</p>
<h3 id="comandos-git">Comandos Git<a class="headerlink" href="#comandos-git" title="Permanent link">&para;</a></h3>
<p>Veamos algunos comandos de Git relacionados con el trabajo compartido
en repositorios y ramas remotas.</p>
<ul>
<li>
<p>Subir una rama al repositorio remoto:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git checkout -b nueva-rama
$ git push -u origin nueva-rama
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Descargar una rama del repositorio remoto:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git fetch 
$ git checkout nueva-rama
</code></pre></div>
</td></tr></table>
<p>El comando <code>git fetch</code> se descarga todos los cambios pero no los
mezcla con las ramas locales. Los deja en ramas <em>remote tracking</em> a las
que les da el nombre del servidor y la rama
(<code>origin/nueva-rama</code>). </p>
<p>En el caso del comando anterior, el comando <code>git checkout
nueva-rama</code> es equivalente a <code>git checkout -b nueva-rama
origin/nueva-rama</code>. Se crea una rama local <code>nueva-rama</code> conectada
a la rama <code>origin/nueva-rama</code>.</p>
</li>
<li>
<p>Actualizar una rama con cambios que otros compa침eros han subido al
  repositorio remoto:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git pull
</code></pre></div>
</td></tr></table>
<p>El comando <code>git pull</code> es equivalente a un <code>git fetch</code> seguido de
un <code>git merge</code>. El comando <code>git fetch</code> actualiza la rama remota
<code>origin/nueva-rama</code>. El comando <code>git pull</code> es equivalente a hacer:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git checkout nueva-rama
$ git fetch
$ git merge origin/nueva-rama
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Subir cambios de la rama actual:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>(estando en la rama que queremos subir)
$ git push
</code></pre></div>
</td></tr></table>
<p>El comando <code>git push</code> funcionar치 correctamente sin m치s par치metros
si previamente hemos subido la rama con un <code>git push -u</code>.</p>
</li>
<li>
<p>Comprobar el estado de las ramas locales y remotas:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git branch -vv
</code></pre></div>
</td></tr></table>
<p>Este comando no accede directamente al servidor, sino que muestra
la informaci칩n de la 칰ltima vez que se accedi칩 a 칠l. Si queremos
la informaci칩n actualizada podemos hacer un <code>git fetch --all</code>
antes:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git fetch --all
$ git branch -vv
</code></pre></div>
</td></tr></table>
<p>Es importante recordar que <code>git fetch</code> (a diferencia de <code>git
pull</code>) no modifica los repositorios locales, sino que baja las
ramas remotas cach칠s locales.</p>
</li>
<li>
<p>Informaci칩n de los repositorios remotos:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git remote show origin
</code></pre></div>
</td></tr></table>
<p>Proporciona informaci칩n del repositorio remoto, todas sus ramas,
del local y de la conexi칩n entre ambos.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git remote -v update
</code></pre></div>
</td></tr></table>
<p>Proporciona informaci칩n del estado de las ramas remotas y locales
(si est치n actualizadas o hay cambios en algunas no bajadas o
subidas).</p>
</li>
<li>
<p>Borrado de ramas remotas desde el terminal:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git push origin --delete nueva-rama
$ git remote prune origin
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Si necesitamos en la rama de <em>feature</em> c칩digo que se haya a침adido en
  la rama <code>main</code>.</p>
<p>Podemos hacer un <em>merge</em> de la rama <code>main</code> en la rama de
<em>feature</em> para incorporar los avances de c칩digo que se han hecho
en <code>main</code> y que necesitamos en nuestra nueva rama:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git checkout nueva-rama
$ git merge main
</code></pre></div>
</td></tr></table>
</li>
<li>
<p>Soluci칩n de conflictos en un <em>pull request</em>:</p>
<p>Recordamos lo que hemos visto en teor칤a sobre la soluci칩n de
conflictos detectados en un <em>pull request</em>.</p>
<p>Supongamos que hay un conflicto entre la nueva rama y
<code>main</code>. GitHub detectar치 el conflicto en la p치gina de <em>pull
request</em>. Para arreglar el conflicto:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>$ git checkout main
$ git pull
$ git checkout nueva-rama
$ git merge main
<span class="c1"># arreglar el conflicto</span>
$ git push
<span class="c1"># ya se puede hacer el merge en GitHub</span>
</code></pre></div>
</td></tr></table>
</li>
</ul>
<h3 id="pasos-a-seguir_1">Pasos a seguir<a class="headerlink" href="#pasos-a-seguir_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Probad el nuevo flujo de trabajo en el tablero del proyecto creando
  un nuevo <em>issue</em> denominado <code>Actualizar la p치gina Acerca de</code>. En la
  descripci칩n de <em>issue</em> comentad que se debe modificar la p치gina para
  que muestren todos los miembros del equipo y el nuevo n칰mero de
  versi칩n de la aplicaci칩n (<code>1.3.0-SNAPSHOT</code>).</p>
</li>
<li>
<p>Escoged una persona del equipo como responsable del <em>issue</em>. El
  responsable del <em>issue</em> ser치 el responsable de integrarlo en
  <code>main</code> y de solucionar los conflictos que puedan surgir.</p>
</li>
<li>
<p>Probad los comandos Git anteriores en una rama en la que se resuelva
  el <em>issue</em>. Cada miembro del equipo deber치 realizar un commit en el
  que se a침ada su nombre a la lista de autores de la aplicaci칩n.</p>
</li>
<li>
<p>Cread el pull request en GitHub, poniendo como responsable del PR al
  mismo responsable del <em>issue</em>.</p>
</li>
<li>
<p>Provocad un conflicto y arregladlo. Para ello se debe a침adir un
  commit en <code>main</code> que entre en conflicto con los cambios realizados
  en la rama. Despu칠s se arreglar치 el conflicto y se subir치 la
  soluci칩n al pull request.</p>
</li>
<li>
<p>Por 칰ltimo, revisad el c칩digo, aceptadlo e integrad el PR en <em>main</em>.</p>
</li>
</ul>
<h2 id="configuracion-de-gitflow">Configuraci칩n de GitFlow<a class="headerlink" href="#configuracion-de-gitflow" title="Permanent link">&para;</a></h2>
<p>El flujo de trabajo Git que vamos a seguir es muy similar al flujo de
trabajo GitFlow (recordad la <a href="https://github.com/domingogallardo/apuntes-mads/blob/main/apuntes/git-workflows/git-workflow.md#gitflow">clase de
teor칤a</a></p>
<h3 id="ramas-de-largo-recorrido">Ramas de largo recorrido<a class="headerlink" href="#ramas-de-largo-recorrido" title="Permanent link">&para;</a></h3>
<p>En GitFlow se publican las distintas versiones del proyecto en la rama
<em>long-lived</em> <code>main</code> y se hace el desarrollo en la rama
<code>develop</code>. A partir de ahora no desarrollaremos directamente en
<code>main</code> sino en <code>develop</code>.</p>
<p>En la p치gina de configuraci칩n del repositorio en GitHub en <code>Settings &gt;
Branches &gt; Default branch</code> se puede configurar la rama por defecto
contra la que se realizar치n los commits y la que aparecer치 en la
p치gina del proyecto. Tendr칠is que definir <code>develop</code>.</p>
<h3 id="ramas-de-feature">Ramas de feature<a class="headerlink" href="#ramas-de-feature" title="Permanent link">&para;</a></h3>
<p>Desde el comienzo de trabajo con Git en las pr치cticas 1 y 2 estamos
haciendo un desarrollo basado en ramas de corto recorrido,
equivalentes a las ramas de <em>features</em> de GitFlow. </p>
<p>Tal y como se comenta en GitFLow estas ramas saldr치n de <code>develop</code> y se
integrar치n en <code>develop</code>. La diferencia es que en GitFlow estas ramas
se integran con la rama de desarrollo manualmente haciendo <code>merge</code>,
mientras que nosotros las integramos haciendo un pull request.</p>
<h4 id="pasos-a-seguir_2">Pasos a seguir<a class="headerlink" href="#pasos-a-seguir_2" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Cread la rama <strong><code>develop</code></strong> y configurarla como rama principal del
proyecto en GitHub. Todos los otros miembros deber치n descargarla y
moverse a ella en sus repositorios locales. Esta rama pasar치 a ser la
de desarrollo principal.</p>
</li>
<li>
<p>Cread tres <em>issues</em> distintos, simulando tres nuevas
  funcionalidades. Deben ser issues muy sencillos (cambiar el color de
  alg칰n elemento de la aplicaci칩n, cambiar un texto, o algo
  similar). Cada uno de los miembros del equipo ser치 el responsable de
  uno de los issues. </p>
</li>
<li>
<p>Configurad el repositorio GitHub para obligar a que cualquier <em>pull
  request</em> tenga que tener la revisi칩n de una persona distinta del
  responsable del PR.</p>
</li>
<li>
<p>Desarrollad e integrar los issues en <code>develop</code> siguiendo el flujo de
  trabajo planteado anteriormente. Deb칠is ir actualizando el tablero
  de GitHub se actualiza correctamente.</p>
</li>
</ul>
<h3 id="ramas-de-release">Ramas de release<a class="headerlink" href="#ramas-de-release" title="Permanent link">&para;</a></h3>
<p>Hasta ahora hemos hecho los <em>releases</em> en la rama <code>main</code>. A partir
de ahora seguiremos la estrategia de GitFlow y haremos ramas de
<em>release</em> que salen de <code>develop</code> y se integran en <code>main</code> y en
<code>develop</code>.</p>
<p>Haremos tambi칠n la integraci칩n haciendo pull request.</p>
<h4 id="pasos-a-seguir_3">Pasos a seguir<a class="headerlink" href="#pasos-a-seguir_3" title="Permanent link">&para;</a></h4>
<p>Vamos a probar el lanzamiento de una release usando el flujo de
trabajo. </p>
<ul>
<li>
<p>Cread un <em>issue</em> con la tarea <em>Lanzar release 1.3.0</em>.</p>
</li>
<li>
<p>Deb칠is <strong>publicar la nueva versi칩n</strong> siguiendo los pasos de GitFlow:</p>
<ul>
<li>Cread la rama local <code>release-1.3.0</code> a partir de <code>develop</code>.</li>
<li>Realizad en esta rama los cambios espec칤ficos de la versi칩n. En
  nuestro caso:<ul>
<li>Cambiar en la p치gina <code>Acerca de</code> "Versi칩n 1.3.0-SNAPSHOT" a
  "Versi칩n 1.3.0" y a침adir la fecha de publicaci칩n.</li>
<li>Cambiar el fichero <code>pom.xml</code>.</li>
</ul>
</li>
<li>Publicad la rama <code>release-1.3.0</code> en GitHub y hacer un pull
  request sobre <code>main</code>. Una vez mezclado el PR a침adir la
  etiqueta con la nueva versi칩n <code>1.3.0</code> en <code>main</code> creando la
  p치gina de release en GitHub.</li>
<li>Mezclar tambi칠n la rama de release con <code>develop</code> (se puede hacer
  tambi칠n con un PR).</li>
</ul>
</li>
<li>
<p>Una vez hecho esto ya se puede borrar la rama <code>release-1.3.0</code> y las
  ramas <code>main</code> y <code>develop</code> estar치n actualizadas a la nueva
  versi칩n. Hacer por 칰ltimo un commit en <code>develop</code> (no hace falta PR)
  cambiando la versi칩n a <code>1.4.0-SNAPSHOT</code>.</p>
</li>
<li>
<p>Debemos comprobar que GitHub Actions pasa correctamente todos los
  tests de las nuevas caracter칤sticas que se a침aden.</p>
</li>
</ul>
<h3 id="ramas-de-hot-fix">Ramas de hot-fix<a class="headerlink" href="#ramas-de-hot-fix" title="Permanent link">&para;</a></h3>
<p>Las ramas de hotfix son ramas en las que se solucionan defectos
encontrados en la 칰ltima versi칩n publicada. Salen de <code>main</code> y se
mezclan de nuevo en <code>main</code> y en <code>develop</code>.</p>
<p>En nuestro caso l</p>
<h4 id="pasos-a-seguir_4">Pasos a seguir<a class="headerlink" href="#pasos-a-seguir_4" title="Permanent link">&para;</a></h4>
<ul>
<li>Deb칠is <strong>realizar un <em>hot fix</em></strong>, simulando la resoluci칩n de un
  error, y actualizando el n칰mero de versi칩n a <code>1.3.1</code>. Haced la
  integraci칩n con <code>main</code> y <code>develop</code> haciendo tambi칠n pull
  requests. La integraci칩n con develop producir치 un conflicto en el
  n칰mero de versi칩n. Mantened el n칰mero <code>1.4.0-SNAPSHOT</code> de <code>develop</code>.</li>
</ul>
<h2 id="nuevas-funcionalidades-para-la-aplicacion">Nuevas funcionalidades para la aplicaci칩n<a class="headerlink" href="#nuevas-funcionalidades-para-la-aplicacion" title="Permanent link">&para;</a></h2>
<p>Cambiamos totalmente de asunto. Tenemos ahora que dejar de pensar como
desarrolladores y pensar como <strong>responsables del producto</strong>. Tenemos
que pensar en las pr칩ximas funcionalidades a implementar en la
aplicaci칩n. Las desarrollaremos en las 3 semanas que durar치 la
pr치ctica 4.</p>
<p>Deber칠is reuniros y pensar en c칩mo hacer el producto m치s interesante
para los usuarios. Pensad que quer칠is poner la aplicaci칩n en
producci칩n y que est치is buscando funcionalidades que la hagan
interesante para que los usuarios se suscriban a ella.</p>
<p>Ten칠is que poneros <strong>en el lugar de los usuarios</strong> y pensar en
funcionalidades que les puedan ser 칰tiles, resolver alg칰n problema. No
es cuesti칩n de a침adir funcionalidades porque s칤, sino que ten칠is que
intentar hacer en 3 semanas un producto lo m치s coherente y 칰til
posible. </p>
<p>Si os qued치is sin ideas, pod칠is mirar la aplicaci칩n
<a href="https://todoist.com/features">todoist</a>. Se trata de una aplicaci칩n
completa de gesti칩n de tareas pendientes similar a la que estamos
desarrollando (aunque ellos tienen muchos m치s desarrolladores y
presupuesto que nosotros 游).</p>
<p>El resultado ser치 un tablero Trello con columnas denominadas <em>Backlog
(1)</em> y <em>Backlog (2)</em>: en la que se encuentren las descripciones de las
funcionalidades candidatas a implementarse en la siguiente pr치ctica,
ordenadas de m치s interesante a menos (de arriba a abajo y de izquierda
a derecha) y etiquetadas con su tama침o. La imagen de abajo es un
ejemplo, con los t칤tulos de la mayor칤a de las funcionalidades borradas
para no dar demasiadas ideas.</p>
<p><img src="imagenes/tablero.png" width="700px"/></p>
<p>En la primera semana de la pr치ctica 4 el profesor se reunir치 con el
equipo y podr치 pediros alguna aclaraci칩n sobre las propuestas y la
estimaci칩n de tama침o de las funcionalidades antes de validarlas.</p>
<h3 id="pasos-a-seguir_5">Pasos a seguir<a class="headerlink" href="#pasos-a-seguir_5" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Haced una reuni칩n, generar ideas en un <em>brainstorming</em>, organizarlas
  y estimar su dificultad. S칩lo podr칠is definir funcionalidades de
  tama침o de uno y dos puntos. Si alguna funcionalidad es mayor,
  deber칠is descomponerla en otras m치s peque침as.</p>
<p>Los puntos indican un tama침o relativo. Si estim치is una historia de
usuario en 2 puntos es porque pens치is que tardar칠is el doble en
terminarla que otra de 1 punto.</p>
<p>Para estimar la dificultad pod칠is usar <em>planning pocker</em>: se
explica la funcionalidad y cada miembro del equipo elige un
n칰mero: 1, 2, m치s de 2. Se ense침an simult치neamente y se explican
las diferencias. Se siguen haciendo rondas hasta que hay un
consenso.</p>
</li>
<li>
<p>Deb칠is seleccionar historias que sumen entre 12 y 15 puntos para
  implementar en la siguiente pr치ctica 4. Para los equipos de 2
  personas seleccionar entre 8 y 10 puntos. La pr치ctica 4 tendr치 una
  duraci칩n de 3 semanas.</p>
<p>Seleccionar las historias que pens칠is que hacen un producto
atractivo, coherente y 칰til para el usuario. Ordenar las historias
seg칰n su valor. Para estimar el valor pod칠is hacer algo similar al
<em>planning pocker</em> pero usando los n칰meros 1, 2 y 3 como forma de
identificar la utilidad o valor de cada historia.</p>
</li>
<li>
<p>Cread un tablero Trello compartido e invitad al profesor
  (<code>domingo.gallardo@ua.es</code>). Cread las etiquetas <code>1</code> y <code>2</code> con
  distintos colores que indican el tama침o de cada funcionalidad.</p>
</li>
<li>
<p>A침adir historias de usuario, ordenadas de mayor a menor importancia
  (arriba a la izquierda la m치s importante y abajo a la derecha la
  menos). Cada tarjeta de Trello debe contener:</p>
<ul>
<li><strong>T칤tulo</strong>. Aparece en la tarjeta.</li>
<li><strong>Descripci칩n</strong>. Muy breve, al estilo de las historias de
  XP. Pod칠is usar el est치ndar "Como XXX quiero XXX para XXX", o
  cualquier otro estilo. Pero siempre debe quedar claro que la
  caracter칤stica debe ser una nueva funcionalidad que pueda usar o
  que note un usuario de la aplicaci칩n.</li>
<li><strong>Borrador de la interfaz de usuario</strong>. Puede ser un dibujo
  hecho a mano o un mockup hecho con alguna aplicaci칩n. No hace
  falta mucho detalle, s칩lo para que el cliente (el profesor)
  entienda la historia.</li>
<li><strong>Condiciones de satisfacci칩n</strong>: condiciones que deben cumplirse
  para considerar que la historia est치 terminada. Son
  fundamentales a la hora de definir pruebas autom치ticas y
  manuales. Las pruebas se definen a partir de estas condiciones
  de satisfacci칩n.</li>
</ul>
</li>
</ul>
<p>En la primera semana de la pr치ctica 4 el profesor se reunir치 con el
equipo y podr치 pediros alguna aclaraci칩n sobre las propuestas y la
estimaci칩n de tama침o de las funcionalidades antes de validarlas.</p>
<!--


## Despliegue en producci칩n con Docker ##


Este apartado lo realizar치 el **responsable de integraci칩n continua**,
pero todos los miembros del equipo deben conocer y entender todos los
pasos.

### Sobreescribir propiedades desde la l칤nea de comando ###

Hemos visto que al lanzar la aplicaci칩n Spring Boot podemos
seleccionar el perfil activo. Por ejemplo para lanzar la aplicaci칩n
usando como perfil activo el fichero `application-mysql.properties`:

<div class="highlight"><pre><span></span><code>mvn spring-boot:run -Dspring.profiles.active=mysql
</code></pre></div>

Tambi칠n hemos visto que podemos seleccionar este perfile para lanzar los tests:

<div class="highlight"><pre><span></span><code>mvn test -Dspring.profiles.active=mysql
</code></pre></div>

La opci칩n `-D` permite sobreescribir una propiedad del fichero de
propiedades. Por ejemplo, podemos lanzar la aplicaci칩n modificando el
usuario y la contrase침a de una conexi칩n a una base de datos con el
siguiente comando:

<div class="highlight"><pre><span></span><code>mvn spring-boot:run -Dspring.datasource.username=root -Dspring.datasource.password=12345678
</code></pre></div>

Tambi칠n es posible definir variables en el propio fichero de
propiedades para proporcionar nombres m치s cortos o reutilizar un mismo
valor en varias propiedades.

Por ejemplo, en el siguiente fichero `application.properties`
definimos el [nivel de
logging](https://stackoverflow.com/a/37167120/540801) (que puede ser
`off`, `fatal`, `error`, `warn`, `info`, `debug`, `trace`, `all`) y
usamos el mismo nivel para los distintos paquetes de la aplicaci칩n:

<div class="highlight"><pre><span></span><code>logging=info
logging.level.org.springframework=${logging}
logging.level.root=${logging}
logging.level.org.hibernate=${logging}
logging.level.sql=${logging}
</code></pre></div>

Podr칤amos entonces modificar el nivel de logs modificando la variable
`logging` al lanzar los tests de la aplicaci칩n, para que s칩lo muestre
los mensajes de error:

<div class="highlight"><pre><span></span><code>mvn test -Dloggin=error
</code></pre></div>

En la aplicaci칩n vamos a usar esta variable y tambi칠n otras que nos
van a permitir configurar las propiedades relacionadas con la conexi칩n
con la base de datos.

### Pasos a seguir ###

- Abre un _issue_ denominado `Dockerizaci칩n de la aplicaci칩n` en el
  que vas a configurar la aplicaci칩n para lanzarla con
  `docker-compose`. Como siempre, desarrolla el _issue_ en una rama
  propia.

- Modifica los ficheros de propiedades de ejecuci칩n para que queden de
  la siguiente forma:

    **Fichero `src/main/resources/application.properties`**

        spring.datasource.url=jdbc:h2:mem:dev
        spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.H2Dialect
        spring.jpa.hibernate.ddl-auto=update
        spring.datasource.data=classpath:datos-dev.sql
        spring.datasource.initialization-mode=always
        spring.h2.console.enabled=true
        spring.h2.console.path=/h2-console


        logging=info
        logging.level.org.springframework=${logging}
        logging.level.root=${logging}
        logging.level.org.hibernate=${logging}
        logging.level.sql=${logging}

    **Fichero `src/main/resources/application-mysql.properties`**

        db_ip=localhost:3306
        db_user=root
        db_passwd=
        spring.datasource.url=jdbc:mysql://${db_ip}/mads
        spring.datasource.username=${db_user}
        spring.datasource.password=${db_passwd}
        spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.MySQL5InnoDBDialect
        spring.jpa.hibernate.ddl-auto=update
        spring.datasource.initialization-mode=never

- Probamos que funcionan bien las variables de
  configuraci칩n. Para ello, lanzamos mysql en un puerto distinto, el 3316:

        docker run -d -p 3316:3306 --name mysql-otro-puerto -e MYSQL_ALLOW_EMPTY_PASSWORD=yes -e MYSQL_DATABASE=mads mysql:5 

    y probamos a lanzar la aplicaci칩n modificando la variable `db_ip`
    para que se conecte a ese nuevo puerto:

        mvn spring-boot:run -Dspring.profiles.active=mysql -Ddb_ip=localhost:3316

    La aplicaci칩n debe arrancar correctamente, conect치ndose a la base
    de datos en el nuevo puerto.

    Por 칰ltimo, borramos el contenendor de prueba creado:

         docker container stop mysql-otro-puerto
         docker container rm mysql-otro-puerto

- Realiza un commit con los nuevos ficheros de propiedades.

!!! Note "Nota"
    Es posible utilizar la variable `db_ip` para facilitar la conexi칩n
    de la aplicaci칩n a un contenedor Docker de MySQL lanzado en
    Windows con _Docker Toolbox_. En este caso hay que especificar la
    direcci칩n IP en la que se est치 ejecutando el contenedor Docker.


### Imagen Docker de la aplicaci칩n ###

Hemos visto [en teor칤a](https://github.com/domingogallardo/apuntes-mads/blob/master/sesiones/08-integracion-entrega-continua/integracion-entrega-continua.md#demostraci칩n-de-docker) c칩mo crear im치genes Docker. Vamos a crear una
imagen con nuestra aplicaci칩n `mads-todolist`.

El fichero `Dockerfile` es el responsable de construir la m치quina
Docker. Usaremos el siguiente `Dockerfile`:

<div class="highlight"><pre><span></span><code>#### Stage 1: Build the application
FROM openjdk:8-jdk-alpine as build

# Set the current working directory inside the image
WORKDIR /app

# Copy maven executable to the image
COPY mvnw .
COPY .mvn .mvn

# Copy the pom.xml file
COPY pom.xml .

# Build all the dependencies in preparation to go offline.
# This is a separate step so the dependencies will be cached unless
# the pom.xml file has changed.
RUN ./mvnw dependency:go-offline -B

# Copy the project source
COPY src src

# Package the application
RUN ./mvnw package -DskipTests
RUN mkdir -p target/dependency &amp;&amp; (cd target/dependency; jar -xf ../*.jar)

#### Stage 2: A minimal docker image with command to run the app
FROM openjdk:8-jre-alpine

# Copy project dependencies from the build stage
COPY --from=build /app/target/dependency/BOOT-INF/lib /app/lib
COPY --from=build /app/target/dependency/META-INF /app/META-INF
COPY --from=build /app/target/dependency/BOOT-INF/classes /app

# Define environment variables
ENV PROFILE=
ENV DB_IP=
ENV DB_USER=
ENV DB_PASSWD=
ENV LOGGING=

CMD java -Dspring.profiles.active=$PROFILE -Ddb_ip=$DB_IP -Ddb_user=$DB_USER \
    -Ddb_passwd=$DB_PASSWD -Dlogging=$LOGGING -cp app:app/lib/* madstodolist.Application
</code></pre></div>


Se trata de un fichero que construye la imagen docker en dos fases. En
una primera fase compila la aplicaci칩n y guarda todos los `jars` en el
directorio `target`. En la segunda fase crea la m치quina resultante, basada en
`openjdk:8-jre-alpine`, con las librer칤as compiladas previamente.

Docker permite definir variables de entorno que pueden ser modificadas
al lanzar la m치quina. Definimos las mismas variables que hemos
definido en el fichero de propiedades de spring boot:

- `PROFILE`: perfil a usar al lanzar la aplicaci칩n.
- `DB_IP`: direcci칩n IP y puerto de la base de datos con la que se
  debe conectar la aplicaci칩n.
- `DB_USER`: usuario de la base de datos con el que la aplicaci칩n se
  conecta con la base de datos.
- `DB_PASSWD`: contrase침a del usuario de la base de datos.
- `LOGGING`: nivel de logging que va a realizar la aplicaci칩n.

Para lanzar una imagen docker definiendo un valor de una variable de
entorno hay que utilizar el flag `-e VARIABLE=valor`. 


### Pasos a seguir ###

- Crea una cuenta en [DockerHub](https://hub.docker.com). En esta
  cuenta se publicar치 la imagen docker de la aplicaci칩n.

- Crea el fichero `Dockerfile` anterior en el directorio principal de
  la aplicaci칩n.

- Construye la m치quina docker. Utiliza como _usuario_ el usuario que
  has creado en DockerHub.

        docker build -t USUARIO/mads-todolist-equipo-XX .

    Prueba a ejecutar la aplicaci칩n trabajando con la base de datos en
    memoria y con logs de nivel `INFO`:

        docker run --rm -it -p 8080:8080 -e LOGGING=error USUARIO/mads-todolist-equipo-XX

    El flag `-it` permite visualizar en el terminal de forma
    interactiva la salida est치ndar de la aplicaci칩n Play y terminarla
    haciendo un `CTRL-C`.

    Y prueba por 칰ltimo a ejecutar la aplicaci칩n funcionando con la imagen docker
    con la base de datos MySQL:

        $ docker run -d -p 3306:3306 --name mysql-develop -e MYSQL_ALLOW_EMPTY_PASSWORD=yes -e MYSQL_DATABASE=mads mysql:5 
        $ docker run --rm -it --link mysql-develop -p 8080:8080 \
          -e PROFILE=mysql -e DB_IP=mysql-develop:3306 -e DB_USER=root -e LOGGING=info \
          USUARIO/mads-todolist-equipo-XX


- Cuando compruebes que todo funciona correctamente, sube a _docker hub_
  la imagen compilada:

        $ docker login
        # introduce tus credenciales en docker hub
        $ docker push USUARIO/mads-todolist-equipo-XX

- Comprueba en _docker hub_ que la imagen se ha subido
  correctamente. Uno de los compa침eros debe probar que la imagen
  funciona correctamente, ejecutando las dos instrucciones
  anteriores en su m치quina:

        $ docker run -d -p 3306:3306 --name mysql-develop -e MYSQL_ALLOW_EMPTY_PASSWORD=yes -e MYSQL_DATABASE=mads mysql:5 
        $ docker run --rm -it --link mysql-develop -p 8080:8080 \
          -e PROFILE=mysql -e DB_IP=mysql-develop:3306 -e DB_USER=root -e LOGGING=info \
          USUARIO/mads-todolist-equipo-XX

    Comprobad que se descarga correctamente la m치quina
    `USUARIO/mads-todolist-equipo-XX` y que la aplicaci칩n se lanza sin
    errores.

- Por 칰ltimo, modifica el script de Travis para que sea Travis quien
  construya y publique la m치quina docker. Antes de que se ejecute el
  script deber치s configurar en los ajustes del repositorio en Travis
  (_travis-ci.com > USUARIO/mads-todolist-equipo-XX > Settings >
  Environment Variables_) las variables: `DOCKER_USERNAME` y
  `DOCKER_PASSWORD`, para que Travis pueda publicar en tu cuenta de
  DockerHub.

    <img src="imagenes/variables-entorno-travis.png" width="700px"/>

    L칤neas a a침adir al final del fichero `.travis.yml`:

        after_success:
          - docker build -t USUARIO/mads-todolist-equipo-XX:$TRAVIS_BUILD_NUMBER .
          - if [ "$TRAVIS_EVENT_TYPE" != "pull_request" ]; then
            docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
            docker push USUARIO/mads-todolist-equipo-XX:$TRAVIS_BUILD_NUMBER;
            docker tag USUARIO/mads-todolist-equipo-XX:$TRAVIS_BUILD_NUMBER USUARIO/mads-todolist-equipo-XX:latest;
            docker push USUARIO/mads-todolist-equipo-XX:latest;
            fi

    F칤jate en el script `after_success`. Es lo que Travis har치 despu칠s
    de ejecutar con 칠xito los tests:

    - Construir la m치quina docker de nuestra aplicaci칩n, asign치ndole
    como etiqueta el n칰mero de build actuar.
    - Si la ejecuci칩n de Travis es debida a un evento que no es un
    _pull request_ (o sea, cuando sea un build disparado por el commit
    de merge con la rama en la que se integra el PR) se logea en
    docker hub con el usuario y la contrase침a definidas en las
    variables. Una vez logeado, publica la imagen usando como n칰mero
    de _tag_ el n칰mero de build. Y esta 칰ltima imagen tambi칠n se
    vuelve a etiquetar como `latest` y se vuelve a subir.

    Por ejemplo, cuando se realice el build `#28` se publicar치 la
    imagen resultante de este build con las etiquetas `28` y `latest`:
    `USUARIO/mads-todolist-equipo-XX:28` y
    `USUARIO/mads-todolist-equipo-XX:latest`.


- Por 칰ltimo, a침ade el siguiente fichero `docker-compose.yml` en el
  directorio ra칤z de la aplicaci칩n. La aplicaci칩n `docker-compose`
  permite automatizar la puesta en funcionamiento y conexi칩n de m치s de
  un contenedor docker. En nuestro caso, servir치 para poner en marcha
  con un 칰nico comando el contenedor de base de datos y nuestra
  aplicaci칩n.

    Fichero `docker-compose.yml`:

        version: '3.7'

        # Define services
        services:

          # App backend service
          mads-todolist:
            image: USUARIO/mads-todolist-equipo-XX
            ports:
              - "8080:8080" # Forward the exposed port 8080 on the container to port 8080 on the host machine
            restart: always
            depends_on:
              - db # This service depends on mysql. Start that first.
            environment: # Pass environment variables to the service
              PROFILE: mysql
              DB_IP: db:3306
              DB_USER: root
              LOGGING: info
            networks: # Networks to join (Services on the same network can communicate with each other using their name)
              - backend

          # Database Service (Mysql)
          db:
            image: mysql:5
            ports:
              - "3306:3306"
            restart: always
            environment:
              MYSQL_DATABASE: mads
              MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
            volumes:
              - db-data:/var/lib/mysql
            networks:
              - backend

        # Volumes
        volumes:
          db-data:

        # Networks to be created to facilitate communication between containers
        networks:
          backend:

  - Prueba que funciona correctamente `docker-compose` ejecutando el
    comando `docker-compose up`. Para asegurarte de que la imagen que
    ejecutas es la que se descarga de docker hub debes borrar
    previamente la imagen que tengas en tu ordendador:

    <div class="highlight"><pre><span></span><code>$ docker container prune
$ docker image rm USUARIO/mads-todolist-equipo-XX
$ docker-compose up
</code></pre></div>

    Ver치s c칩mo se ponen en marcha el contenedor `mysql` y el
    contenedor con nuestra aplicaci칩n. Prueba a conectarte a la
    aplicaci칩n y comprobar que todo funciona correctamente.
    Puedes terminar la ejecuci칩n
    haciendo `CTRL-C` o lanzando desde otra terminal el comando

    <div class="highlight"><pre><span></span><code>docker-compose down
</code></pre></div>

  - En el script de `docker-compose` el contenedor `mysql` utiliza un
    [volumen](https://docs.docker.com/storage/volumes/). Esto permite
    conservar los datos que se introduzcan en la ejecuci칩n del
    programa, aunque el contenedor se borre. Tambi칠n ser칤a posible
    hacer un backup de estos datos a partir del volumen.

    Para listar los vol칰menes mantenidos por docker:

    <div class="highlight"><pre><span></span><code>docker volume ls
</code></pre></div>

    Para eliminar un volumen:

    <div class="highlight"><pre><span></span><code>docker volume rm nombre-volumen
</code></pre></div>

    Y para elminar todos los vol칰menes:

    <div class="highlight"><pre><span></span><code>docker volume prune
</code></pre></div>

- Haz un commit y sube los cambios a GitHub. 
- Crea el pull request que cierra el _issue_ y ci칠rralo, comprobando
  que Travis construye la m치quina docker y la publica en docker hub.

    <img src="imagenes/imagenes-docker-hub.png" width="700px"/>

- Por 칰ltimo un compa침ero debe probar el comando `docker-compose up` y
  comprobar si se ponen en marcha las im치genes docker y nuestra
  aplicaci칩n funciona correctamente. 

-->

<h2 id="entrega-y-evaluacion">Entrega y evaluaci칩n<a class="headerlink" href="#entrega-y-evaluacion" title="Permanent link">&para;</a></h2>
<ul>
<li>La pr치ctica tiene una duraci칩n de 2 semanas y debe estar terminada
  el martes 1 de diciembre.</li>
<li>La calificaci칩n de la pr치ctica tiene un peso de un 7% en la nota
  final de la asignatura.</li>
<li>Para realizar la entrega uno de los miembros del equipo debe subir a
  Moodle un ZIP que contenga todo el proyecto, incluyendo el
  directorio <code>.git</code> que contiene la historia Git. Para ello comprime
  tu directorio local del proyecto <strong>despu칠s de haber hecho un <code>mvn
  clean</code></strong> para eliminar el directorio <code>target</code> que contiene los
  binarios compilados.</li>
</ul>
<p>Para la evaluaci칩n se tendr치 en cuenta:</p>
<ul>
<li>Desarrollo continuo (los <em>commits</em> deben realizarse a lo largo de
  las semanas y no dejar todo para la 칰ltima).</li>
<li>Correcto desarrollo de la metodolog칤a.</li>
<li>Correcta especificaci칩n de las funcionalidades.</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Pie">
      
        <a href="../03-pruebas-tdd/integration-tdd.html" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Pr치ctica 3
            </div>
          </div>
        </a>
      
      
        <a href="../05-iteracion-scrum/iteracion-scrum.html" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Siguiente
              </span>
              Pr치ctica 5
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copiar al portapapeles", "clipboard.copied": "Copiado al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.term.missing": "Falta"}, "search": "../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.a1609d9a.min.js"></script>
      
    
  </body>
</html>